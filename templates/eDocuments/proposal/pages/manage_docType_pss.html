{% extends "eDocuments/layouts/layout.html" %} {% block title
%}ຈັດການປະເພດເອກະສານ{% endblock %} {% block head %}
<style>
  .card-box {
    max-height: 400px;
    overflow-y: auto;
  }

  .card-item {
    width: 100%;
    text-align: start;
    background-color: var(--third-color);
    line-height: 1.5rem;
  }

  header button {
    background-color: transparent;
    border: none;
  }

  .dropdown-toggle::after {
    display: none !important;
  }

  #list_group li {
    list-style: none;
  }

  .table-container {
    overflow: auto;
    max-height: 50vh;
  }

  .dropdown-toggle::-webkit-scrollbar {
    display: none;
  }

  table thead th {
    position: sticky;
    top: 0;
  }
</style>
{% endblock %} {% block header %}
<div class="d-flex justify-content-between px-3">
  <button onclick="window.location.href='/edocument_menu'" class="first-btn">
    <i class="bi bi-chevron-left text-white"></i>
  </button>
  ຈັດການປະເພດເອກະສານ
  <button disabled onclick="window.location.href='/add_document'" class="second-btn">
    <i class="bi bi-plus-circle-fill" style="color: #276fb7"></i>
  </button>
</div>
{% endblock %} {% block content %}
<main class="d-flex justify-content-between flex-column gap-4 mt-2">
  <div class="form-group mt-2">
    <label for="" class="form-label fw-medium">ເພິ່ມປະເພດເອກະສານ</label>
    <div class="input-group">
      <input id="docTypeText" type="text" class="form-control shadow-sm" placeholder="ປ້ອນປະເພດເອກະສານ" />
      <button id="btnAddDocType" class="btn text-white fw-medium shadow-sm"
        style="background-color: var(--second-color); width: 20%">
        ເພິ່ມ
      </button>
    </div>
  </div>

  <hr class="m-0">

  <div class="table-container rounded shadow-sm border">
    <table class="table table-hover table-striped table-bordered mb-0">
      <thead>
        <tr>
          <th style="background-color: var(--second-color); color: var(--bg-color);">ລະຫັດ</th>
          <th style="background-color: var(--second-color); color: var(--bg-color);">ຊື່ປະເພດເອກະສານຍ່ອຍ</th>
          <th style="background-color: var(--second-color); color: var(--bg-color); text-align: center;">ຈັດການ</th>
        </tr>
      </thead>
      <tbody id="docTypeList">
        {% for data in docType_data %}
        <tr>
          <td>{{ data['doc_type_code'] }}</td>
          <td>{{ data['doc_type_name'] }}</td>
          <td class="text-center">
            <a href="" id="deleteDocType" class="text-decaraction-none text-danger"><i class="bi bi-trash-fill"></i></a>
          </td>
        </tr>
        {% endfor %}
    </table>
  </div>

  <div class="d-none form-group mt-2">
    <label for="docType_code" class="form-label fw-medium">ຈັດການປະເພດເອກະສານຍ່ອຍ</label>
    <div class="input-group">
      <select name="" id="docType_code" class="form-select shadow-sm">
        <option value="" selected class="d-none" style="display: none">
          ເລືອກປະເພດເອກະສານ
        </option>
        {% for data in docType_data %}
        <option value="{{ data['doc_type_code'] }}" data-name="{{ data['doc_type_name'] }}">
          {{ data['doc_type_name'] }}
        </option>
        {% endfor %}
      </select>
      <a type="button" id="deleteDocType" class="btn text-white"
        style="width: 20%; background-color: var(--second-color)">
        ລຶບ
      </a>
    </div>
  </div>

  <div class="d-none form-group mt-2">
    <label for="" class="form-label fw-medium">ເພິ່ມປະເພດເອກະສານຍ່ອຍ</label>
    <div class="input-group">
      <input type="text" id="subtype_text" class="form-control shadow-sm" placeholder="ປ້ອນປະເພດເອກະສານຍ່ອຍ" />
      <a id="add_subtype" class="btn text-white shadow-sm" type="button"
        style="background-color: var(--second-color); width: 20%">ເພິ່ມ</a>
    </div>
  </div>

  <div class="d-none table-container border shadown-sm rounded mt-2"
    style="height: 30vh; overflow: hidden; overflow-y: scroll;">
    <table class="table mb-0">
      <thead style="position: sticky; top: 0;">
        <tr>
          <th class="fw-normal" style="background-color: var(--second-color); color: #fff">
            ຊື່ເອກະສານຍ່ອຍ
          </th>
          <th class="fw-normal" style="
              background-color: var(--second-color);
              color: #fff;
              width: 60px;
              text-align: center;
            ">
            ລຶບ
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="text-center text-danger" colspan="2">
            ກາລຸນາເລືອກປະເພດເອກະສານ!
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</main>

<script>
  //   delete  document type
  document.addEventListener("DOMContentLoaded", () => {
    // Attach click event listener to all delete links
    document.querySelectorAll("#deleteDocType").forEach((deleteButton) => {
      deleteButton.addEventListener("click", (event) => {
        event.preventDefault(); // Prevent default link behavior

        // Get the docType_code from the row
        const row = event.target.closest("tr");
        const docTypeCode = row.querySelector("td:first-child").textContent.trim();

        // Show confirmation dialog
        Swal.fire({
          title: "ລຶບຂໍ້ມູນ",
          text: `ກົດ "ຢຶນຢັນ" ເພື່ອລຶບ | ${docTypeCode}`,
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "ຢຶນຢັນ",
          cancelButtonText: "ຍົກເລີກ",
        }).then((result) => {
          if (result.isConfirmed) {
            // Send a DELETE request to the server
            fetch("/deleteDocType", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ docType_code: docTypeCode }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  row.remove();
                } else {
                  // Error dialog
                  Swal.fire({
                    title: "Error",
                    text: data.message,
                    icon: "error",
                    confirmButtonColor: "#d33",
                  });
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                // Unexpected error dialog
                Swal.fire({
                  title: "Error",
                  text: "An unexpected error occurred. Please try again.",
                  icon: "error",
                  confirmButtonColor: "#d33",
                });
              });
          }
        });
      });
    });
  });

  //   insert document type
  document
    .getElementById("btnAddDocType")
    .addEventListener("click", function () {
      const docType_text = document.getElementById("docTypeText").value.trim();

      if (!docType_text) {
        console.error("Missing required data!");
        Swal.fire({
          icon: "warning",
          title: "ກາລຸນາປ້ອນປະເພດເອກະສານກ່ອນ!",
          confirmButtonText: "ຕົກລົງ",
          confirmButtonColor: "#3085d6",
        });
        return;
      }

      fetch("/manageDocType", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action: "insert",
          docType_text: docType_text,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            location.reload();
          } else {
            throw new Error(data.message || "Unknown error occurred");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "ມີຂໍ້ຜິດພາດ",
            text: error.message,
            confirmButtonText: "ຕົກລົງ",
            confirmButtonColor: "#d33",
          });
        });
    });
</script>

{% endblock %}